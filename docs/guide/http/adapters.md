# Create an Adapter

This guide is for those who wants to create threir own adapter and get more control over the wooks.
You can use your own router and handlers processing but still benefit from wooks composables.

This technics can be used to write wooks adapters for other web app frameworks.

## Create a new Wooks HTTP Context

Wooks HTTP Context is a special object that stores:

1. **instance of request** - is used to get data from request
2. **instance of response** - is used to send a response
3. **parsed route params** - usually Web App frameworks put it to `req` (`req.params`)
4. **cache store** - is used to cache alread computed values, e.g. parsed body, parsed cookies, ..., in order to avoid multiple parsing/computetaion of the same entities.

When request is generated by the client a new Wooks HTTP Context must be created.

`const {restoreCtx, clearCtx} = createHttpContext({ req, res })`

```ts
import { createHttpContext } from '@wooksjs/event-http'

function requestHandler(req, res) {
    const {
        // restoreCtx hook helps to restore wooks context
        // after any async operatuon
        restoreCtx,

        // clearCtx hook helps to clear wooks context
        // when the request is already processed
        clearCtx,

        // store hook to access wooks store of the current ctx
        store,
    } = createHttpContext({
        // request instance
        req,
        // response instance
        res,
    })

    // if req already contains parsed params (req.params)
    // then those will be picked up automatically
    // unless you overwrite it here
    store('routeParams').value = { name: 'value' }
}
```

## Create a responder

Responder is a function that takes any output of the request handler and transforms it into http response, processing headers, cookies, formats etc.

`const {createResponse, respond} = createWooksResponder()`

```ts
import { createWooksResponder, createHttpContext } from '@wooksjs/event-http'

const { createResponse, respond } = createWooksResponder()
/*renderer, // (optional) instance of TWooksResponseRenderer*/
/*errorRenderer, // (optional) instance of TWooksResponseRenderer*/

async function requestHandler(req, res) {
    // 1. create wooks context
    const { restoreCtx, clearCtx } = createHttpContext({ req, res })
    // 2. process request based on routers/handlers and get the output
    const response = await processHandlers()
    // 3. restore wooks context
    restoreCtx()
    // 4. respond
    respond(response)
    // 5. clear wooks context
    clearCtx()
}

async function processHandlers() {
    // routing, processing, handling, ...
}
```

## Use it with HTTP server of your choise

```ts
import http from 'http' // [!code ++]
import { createWooksResponder, createHttpContext } from '@wooksjs/event-http'

const { createResponse, respond } = createWooksResponder()
/*renderer, // (optional) instance of TWooksResponseRenderer*/
/*errorRenderer, // (optional) instance of TWooksResponseRenderer*/

async function requestHandler(req, res) {
    // 1. create wooks context
    const { restoreCtx, clearCtx } = createHttpContext({ req, res })
    // 2. process request based on routers/handlers and get the output
    const response = await processHandlers()
    // 3. restore wooks context
    restoreCtx()
    // 4. respond
    respond(response)
    // 5. clear wooks context
    clearCtx()
}

async function processHandlers() {
    // routing, processing, handling, ...
}

const server = http.createServer(requestHandler) // [!code ++]
server.listen(3000, () => {
    console.log('Wooks Server is up on port 3000')
}) // [!code ++]
```
